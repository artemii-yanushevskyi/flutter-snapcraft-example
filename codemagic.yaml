workflows:
  snapcraft-release:
    name: Snapcraft Release
    instance_type: linux
    triggering:
      tag_patterns:
         - pattern: '*-test'
      events:
        - tag
    environment:
      flutter: master
      vars:
        SNAPCRAFT_LOGIN_CREDENTIALS: Encrypted(Z0FBQUFBQmdrbnozWXB1ZUpueDNpUXpFR3dWY0NuZDc1TVhUQy1DTW1ZRzkxVlptRGxNdUtpaU5VOXgzdjltd0E1M2U5Uk5tU3d1c3hTMFpXOHJvN1V6NkoxU3d1aVY1Q3FuQS1EOHpSRENHSmY0S2JtaUlTSW1yLUttNVM1UnQ5WUM3S2FvVWpwemx5eDlTNlNZWTFTNURad0FpWDRQWEx4VUJYMDNIR3JMaXRLRkx1eHM2aUdaUmVlOTI2NFRNVFFySGptRndudXU1bVhtRTZ6RG9zemtsZkIxTks5YnFGVjJLYUlFZlRwNUVUTDRIbENjNkh2RmN4UDR0bU5icjhab2pRX2dEZ0VtdTlSQXNDVHVUN1dOTE5UZkJHeTJBdFJGcklaMWFhMlUxd0RFaTNYMHQ0dXFzamt3UTlwdGxNbFd5VzU4YjFjUWRXLUpzZUF4TE9WY2JnM2huWjJxUnZzVnZVMjZFUmEzZU5BZ3FWSEdzQXFFQVdaWTZ0TFR0LXFIMFZTd3M4NzhyWG5rT1J5ZWdhYzNKbGdORDBjM3FjWERxdFhFclc0UDJEZFVETEFnTHVyZTJLcW9FLUhEMDktUlBNRi14REVtdU1OclR4Z0F0cXRHSlFGaWRxNGtJQXlQZjJvVXFXMW1BQllPTzNGc3NPX0FoTE15dENGbkpiSHBmOGZUay1oUjQzdjY1amVTRVlfeTdmeWhuYkdlTElDb1dtbUFDYlgtQ3U0QzdHcDB6Yk9fR1Q0WDkxQXZWQjNRSUxMT0ZDZ2F6cjM4UFlLVmhBcTFBNEZWMTFmUXZINUtPVFdDLTBYNjZGU3ljNC1NQ2Z3RW1oU0RCVDZ0cnh6cEFDMGlvMzY0TmRaUWhCc3N2WFZiWURwcnZETVZObVpsblhXM3JGRnJuazBhQWZXakp6TFdET2o3Qkk4Vkd2WGlYUWVtVEk2QVNyNUlQc0pDVm9TcjhLMmd0ZmpXTTFUdXRpOUxHVGdxdXkyQmxra3RfVFJBbWJaZ3E3WWNaZTFZTWNkdkgta2l6eXlyUHF2TEx1cXZiLXU1bW9NUlM1MjJwUUZ0MnZobXFUTjY3TjFKSHp3dHJMWlZ0dE5rOUlxVUtpLWM1QlJ2S19hMjlHY1JXRWVtN0JqWTZvdUNLRDA1eHNlNjBGd2FFOGV5TVVVbGpHZTdqQW1Fd0tMYUdiMC1lcmdSc0UyYy1jaWtoUWwyMlEyVzNVZGxxR1MyYUNQbExyOVRzYWxhMmtwUFVPSEdxMkRrX21DLVR1QVJZVXJULWJXWDlnc1VZYjJKSElIN3pCNnVSOXQ0bjhCS0lzRW5ScDNQTXlQTnJqRUhMWFVoUHZJZDZwZ0k5LVdiMnRZWGFYNUZxRmpNazBURjVrclJIZTFTbm9lYjZGZHV4bDdtbmszc21VY1M0ZGhHRXJVM0daYU1LUGFZTmZVOWpUWklKRGdOQ3phMTJtcVpOVWxkSldUeXVsc0tNeUswWXQ1NUdEckxtMlpndWJpdmRaeVhnYlRUdHgzR1NqN2FaS2t3OHBUNWlaTlZndkdpU2xVbktQNjVRU29EeFFZVUUwaEZzTWtWVGh0MENhVXZyQ2V2QWlsRjlmbHNVOWFpclZldy1hRHIxaHV5N0xaU2ptM3VrTW9pM1ZqemE5YlpXWUo1Rzc0YzRQazdOSTBoemhWV1c5MnUwa2JvWHhaMEpneWxvR3pqQ0hfWUdIWE9rSlV5WHRJNXJDcEJXZXp4WndHTGpMWk1KMzZuY2JqcFhKUW4taXVOaXhIbDJXT2ljTXhJNF9LTDdPVGRINk9mVmt2TVIwb2pqN01LRjlBVFF2NmxNT0s0OW1PWTljM0JhV1dqNjN2R2paeWJsUXY2OXQzY1RVSGxnYmg3VGdEaUFPY2dHSUxRLUtTdmZOZ2JTalpqbTdPaGFaOGprYWZTdEs5WllCZWVRVXpkdGk1U3NkbnRuYzRhUlB3TVBrdXlqMFlvXy1lelRQZGNaRlFaTG1mMl9ucktPWVJ3VDVCa1E1WnZRS3NMdWhlVEVRM0RjUlM5M1R4TGJ0MG9jWWdIdm5pYW1hWDFMZEh1cm9TYUo4VWlnRFJHWHNqOXlnVGIzMDlwd0F6aXpCYXByaDlMdjAyelE2czlraE1RUmhwOS1HZzkzYzZNYURLc0l6b25nNUZsMUY0YVl5THRQYVBTalFhS2V2TzVXc2h5SEsyM1FPUEhnQ3haM2RMVExfYVpKNnBrYTE4eFlmYXk1TjNWZ2UwMkM2V1Nmdk14VjFpMVlKeFJ5QkFwcVg1M2tDQm82c2xHblJxTWxGWnpwX2JyRVNfN3dJcDNZdkNsWk12Y1VfMDU2b1o4aG9WTUpsVF91Wnl3NGdZTlB4U096Mm8yRjFtVjNoc2NpQXVyTzhuc1pZTUgzelJwSHNRclRLN3VkTW5yd3pOXzNXeHg0b0p2Y3NKalVpRGRuWmwxS3ZNdTlJMS1lZndrVldBNUp6SGxIbmhkdm9GV3MzN3E4QU5uYmRoODNWcUE2bGNUeENuVkotMUZORWNkSUI5QWRjdTVFdUhpS0xtRmkxbk1hVjZnTlV1Q2NWcnVTZHFSaTE5ckNtUDhrQmxWc1VIcXVhNnozZ2FkdXNvZDFrVVRDTmhyemNndFRjVlMwNWlhdUNzZzhLdm1DWXhvYWJyb212WFRzWW1FZkN6RTdYT2dqYnVrYkJUNmswZnA3aEJablJOZHgwX25SbzNBU3Y2YUpVQWdLb2Z5TGhJVU5FRGxYeEVrMW5vSmVmekh3YzFxM0hKWUItX1poUGdJQllRQnhEUV9sUEFnV25ERk4ycTJTcktvSHNrdHBNQWU0OTBva290Y2ItQ29aYWtvX1AydnJjT1Q3NlExdGZHcUJZcy1pNkI1V2ZhU2k2QkxoWDcwcE81dEp0eVdkM3NQVm42bjFqZ2pnMlM3ZXQyb3JINmhPNUlJMDVXT05Mak51elBRYW5wb3FaSjBnNjAwRm9ZRG9OSnZUWmVSdkR0REkzSzRDUEhGRWh3UDk3SDBUOWREUWh0cGI5X3RfeU5zX1NFckJZZVlMRkhMZ244Q2xxUG54YUx0WUZjTGxYbFdBeGN0TmFyQ0lCWFNIdFEwN1gxbkRibW5vOUlmd05ZbEZSQjVKZmJwb0JLbWYwRWpVb2x3Mmhobnp4aWNGckcwY0FHZHhZVE54WnRXTFl6dzNqSEQ5MXp3SUpLekJUaTdvTURubnl1eHd3cl8wNENWcVlDQ0Vhbk05N09YRmxWdlA2X2pQYXJxNUxQMHRnRzhyOTgxMElUT0ZzSDNEdlNkeGZYVlJVTV9qLUJ4dUljOV9ScHI0R0psZlYxYXQ4UUFXeDdoZVA1cXhPY1VmM0M4SzhyU0NBQWs0SldqYjVob1M0bUFwaDQ5aHpQWEFmU3pnTnZOSXl0emZkMS0ybG9yOWhmcGd5SnhqR0p5Z19IbXBrRTFDdUcyTjgtX3FxcU1UUEd1RmdmWXNwSnNIcTJLTktudkhoTVpEQ3pIaDYzSXUxd3c0VzNhOFJNbDV3emlIN2Z4TVpMeVBkWExUZzNvazd5Z3FUR2xZZlIzakFHTkR4Ymw0N2kzMGZNWG95V2luX0FSNmNORU12cEwzbnhMM1prU25LOU0tZUVQeW9vcFVfRmVzWW9uUVZLT1ZtaEZ5MWhSVG1YYUFRMlZRQ1lXc0xFV2ZQdDZ3cUZKSFJfYklsNDlhOUpFMk9kcWRCeG5tUFZyTDUwUHcwS0xHYndfMG5mS2RNbzZPVUthSlpQNk52NzZMa1VuaTU2OXFyZFVsMUh6MHlIbFRnT250eXhBVW5zX1lCRzQxU3d3dms3Y3lhYlBzWGdqMVZHbWs1RDNsUF9QOGlMLVdkOVFNM2pyM1l6TVI2WFZ3cW5ZSXppNWxOaE9ZdTZvNzBuVzBtcVZ6ckgzYlNpWXQwa09td0F5QkRDZVp3OUtSZm1nQmE3b0p2d0RSd1pZY1NJTkJEX3hnWG5FOWJOZC1VZzJLOElzcUlMSzNNQ0xBRE56bkttbUp2VDkwSXF4SXd5NFJDUHN0d3dVanZPTlp5WS05ZVhBdXk4XzhPLWt6MmdfeDA2Wk5RcHR6RUZwOVJfUW1BYnMxV05LbVpEUGVJNEZteFFNcW8zdFQzMlkzSjltV3pXMVpvTjlhMmQzdzZqdkk0UGdWa2FUZXR3alBZT2ZyRXp5QlhvZzZpM2pzTXQ4N0NqSGdTRUs2OUpocjVzS3gza1ZCY01OX2tEYThKeV9WSzhza1BhOG5kWFlGTGlPMWdKZ1gwaFRyeFNXSk9RNnVFWkZmQXNQeEZudDZOR0pWbjJZZnM1NXFRc21JVFVmdXd1WEh3MGRZZDdhYWJWN29SM3JUblBlSmgtMW81QUR4UGRTMGVPN2U3ZTZ4Tl9tOGt0TWFSQVdpYnVETFNTTmloRHppUFlxS0cxWXhhOVBkRHJsMEdBZElQb1BaeFZhcjdITHZ2RmQtTjE4ZGpLN2o3OUtfdnNBLVUxSm1zNG5aQ2dldFN1YXZ0LVNlamM5Rk1xUXduNDg2OXZfVGJfV3J3UG5NZjEtLVBwMWNtVXFnZ0lvVUdPRVJnandrVkFvN1AzQzBzM2lYejFSZU8wakNMdGx4bzZsWUtXN181N1Boem4tRHdXbHhURktEZTU5cmFTQktPQ0NGQzl4eno1UXZFNzZqcmNjNWJWMWJqQVkwN0xLR0RSX3NyQi1DamhMNFgtOUg1dXVOTjF4OUViU1BqZ3l5SGpYYXpNM1FVQ3NhOHZHS1k1TVF2SkVFZnhtQVhGWWdESjBsRGlsd2ZkTWlNSUhSc0pOcEpQZzdtMzJ6cks3V2RBb1RLNG1VLS1ZSkdCekpiNDlRbXV3VkFvcXYycnZ0TEttcXprTUFXR0hMcjVZVzBIM1Z6Q08tcC1jLWlRUFZkRkRYclFFTGo2TnNVeUExWUtkUWFQeGMyc080S3loS3FtYi1Va3NqeENRMVM5bjNTUU5XV1JxTTlZWVh6c1ROdUt2dGR2dWNSUFBiMjJsWjhZMXVlYm84NHJtX0xNX0o5d19uM1dsSWMzTEE2bjQ1QUVSVzR5UUxxcWlaaWRzcEwySGcweV9UUmhQMXp1b3B0ZmpiRzVQXzFWV08tR2dMd25YRkVxaEIwY1hMTFVoZndyRERCUEZDVi1UR2ZHc1hoSWhBN3c2bnJkV0Q5ZUN4UjgxOHRiaENyXzMtTU9zSnNHb3JSTTduME03VGtDVVhOQkltazRsTkdGM0xzRVlRSzRKVDRtMlhWZ1RSTzIza0l6eGwyRjVTQ3ZoWl9jdGdadGwxeGg5MUxTYl9FUkRHNVJYNXlyQnZwZExySWhwX3NmQXFtaVhnbHVBRnlvU3ZoQy1kNUpWdkpfRGxGXzRjWEMzYXIyeWIzYTJvSkxrdTNhdEU4ZTQyRUlTN2tQNExKRmF1UXhsZ2h5cHk1SFItdWpWSjltU1JrLWRYU1dIV3dzR2RjVDFDOWZtR3hKaTl5U2REbUhBZkVEazZ0am9VVVBxTXN4cHBLeEc3RGYwSUFUVjdEOENZZGFia2E5a203TGdmNng0cHVPUE50VnhJZTRRUjFIc0N3ZmFOY1JOaXRRTlRwYkg1MGhwdkh1TzkzUTN2TWFJSmtYRllpb3cydkw0MFNKWk9NQVNJa1EyZDNUNkxURm9aYXFxWXAxMlVwcHJMYkxxaU13amtGUno0YTdaTEhaX1dnYWpKc1FKQTdYenpiUmFCQXloSjZRWmRHTmJ3ZUo3V2hDb2k1X0pqYjNKQnlzQU5zd0VVR0ZEVDNMemY=)
        SNAPCRAFT_BUILD_ENVIRONMENT: host
    scripts:
      - name: Authenticate
        script: |
          echo $SNAPCRAFT_LOGIN_CREDENTIALS | base64 --decode > /home/builder/snapcraft-login-credentials
          snapcraft login --with /home/builder/snapcraft-login-credentials
      - name: Create a snap
        script: snapcraft snap --output flutter-codemagic-example.snap
        when:
          changeset:
            includes:
              - 'README.md'
      - name: Upload and release
        script: snapcraft upload flutter-codemagic-example.snap --release stable
        when:
          changeset:
            includes: 
              - 'README.md'
