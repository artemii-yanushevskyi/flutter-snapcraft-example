workflows:
  snapcraft-release:
    name: Snapcraft Release
    instance_type: linux
    triggering:
      tag_patterns:
         - pattern: '*-test'
      events:
        - tag
    environment:
      flutter: master
      vars:
        SNAPCRAFT_LOGIN_CREDENTIALS: Encrypted(Z0FBQUFBQmdpcFdNWDFYTWp6QlE3ckJ3c3FHWUxCV0hVN0lwNktraW1keTBWWVF3YVBMVzl1aURTUUxjRVJzMUxGZk5PekUyQTRoTjhONk5OTklHT05SNjRmLUc3a3J2Qlo2bExldlRxdEFuNllvdEp1SlVyTndUbDFBZFVWMGo3Mkk2b3BwNmU0ZEVlNjBlNTJsZkh4Z3FCWm0tZU02TXZnX0E5VG1uRGxXVkgzSHQ0b0RDejZXbUwteXdoZkxGN0pudHM3VkF4X1lqVVk0M3NwY245MUVFVHA0VTctb3dCS0pkUGNBOWY4WWVUNHNaYm5mZjNBQnJPUG5aWVdkTWhuQm1BNHExZnBTWmJ3QjU3ekVFaGxqYU4tTU41cFEyV0lVUWhvY2g3Qi1NMHVWODNPVFBsZkhuSGtxWDJmWmh5M2xUZjdLUUVaYXJaMTJMUzkzSURCa0p6dDdsNk9HcFF4M2U5ZWtXUnh5OEJ5RDlxZ0drMTZBVzhUbklHSVRtSFRibHI0YWxWOENPWnB4MTdUTmJJNk1Jckl2Tmp0bWctSDZicnd5X1c1N3RGM0ludDJtNnlfNE5XeWtGOEcxeDQzemtQTkctUmYwa2NiRGZ2NDk1QTcyRDlZZWV1bGF3TDYyU2JQcFJOd2FsU2xlM2pNQ0taZGRwa0JubVdTMWdmUlFDVThhQUJ4VVpsZkFtNU40VVY2bUFjZ1RzVXRCLXNjZ29ZbDNsUGViTWhGVnFXNTJmaDBVeXpDWWxfZlZyN3puaTBncmNJZnEwZXU0NjdYaHVrWGNWSERFdnpKejNsbnE3U1pPbDliZ0RON0YyU1hrMEI1Wi1aLWhtMWt6Yks5Z000RnBHX1JVTUhJSTQ5ejB5OGtuRGR2OURYV2RGZk9OZjNJYWRxeVk0c0lSVHU0aXQ1TlZiVk85cU5YaXV1RTNQV3FHNExCeklnM1F3bG4xLUNTdWlmZzNyUWtvdlNWbVZuU0FVaTQ0UEJkUXVLdWR0WkZua3NlSlN3cmo0T3YycXJDVEdsM1N0dHZ6NUx3YUNZVHp5akY4ME1QSWpveGxWdmJoZThwbU9ObXppdVpGd2lPQzRuVC1qNlhYQzc2RGpYdW03RjBtblRFcDROZHZ2dWVkbFhXQm5aU2kwdm1YcjR6WFVIUU5ua202MUtBN2dfT04xX0pjSUkxbEU5NUpJanE0MGxiRUhPdFN5ODJRdUxqOWdmZlFIOHVKbE5NU3lFbzFRYzZBY19nWEwxd01XYlF0SzEzTWNIcmJieC1oc2RSLUg2cjVieU9Jb1UwYWYwSE1NbUU1MWItdmpEaDZBSV9kcmlfX09LX0x6cURSYm8zZlNBYUZtUEVodHBiWW9jeVE0d0puQjRZTnhscmFLZTVOcGJkV1BtcF93MXJSQ1FyUHNLMVhvajJhS0FQd0xiUE9CVTFIbWhLdW1HUzFzUDNCNklGdXA4WFk5QXhkUnlkOEN4SjRseVpjUFUxQUQxVXdEcXRFMnBseVhHSS1YQkZ5d0tMT0hubkwzOFBLNGt2aXFoUmpzWHF3V1hobU9GQlhyR3dvSGplUjFGdkpENDNiV1QyMFFvXzQ4MEViMkR0U2lyQzBzZThsNTk0eUlHbFlVYzBTdDhkNWt4Ul9yV3lxZE8tNFlXRDBZT2NxcjBKOHZ0cGlJZXlWZExyMzBpVWZxVlFnZG9RWFd1S0VSUzFaclk0VWQ5OHR1aUh5X3NmUEQ4SENISFcxcE51T2xtd2s5MUFqZ09hWnpDalQ4V3lUVGswbEU0NmViUGhhY29PbUNkOTU0QTEtN1ByM2djNUpvSVlVeVBhNjJ1YmhrOGRYRmlncWI0alRqNlA0empUTV9SY2FaLWFfUVFJR2NVQ0N0c1dzX1VyZXhaRzd5Q1BlWERCYW0wdVJadFNPRWxzZ3VldC1ua2Qyb2VzU3FlNk83RmRpdUtkdHkwaXpKWlVPaG5rWHVCclpMZm9KRGRnUWhnaC0tRnZBQ2laSURJX3JOVXBnb3NYZHRLb1FXRHR1dFZZc1BmbmJYSkRlWjl4NDZxdTQtNzIwb3JxYmlua0FQdVpKdkY1R0ppRC1WNlhndEhIYl9TVjQ0TnRkbWFOTG0yZ1hNcC1rYlBVNTJqaWg3bFRtN2hBQ0F6RDdjdVFYTVhxS0FWUTVuUWJOeTJLblEweTdPcXhDbHA3RzR3OTR5b3BhTi12N0FIcjduU3V1d3VkMGVKNEV0QnlrNFZyS1Fnd2xMVUZieGNMbVM1TjUxRzNPMElTelZYZk5fNFJFT2o1RmlOS0w1SVRzamdiOFZPUFE5ZE9TODRBLXJRNU9IQTB0X2pVMVhFblRraVEzaDQ4S3Y1ZTJfWkdoWnpVYTZ5c2M5cC1nZjdFb1ZkWkZEZnEyQUVLWnczTjlPcjZHTUFHOE9xbTZGTjFMaDVlRTlpbjZ0MU5COHZWYmRsTTBQUU9vX2xHN1dOMUFrbl9tSnZ2U0JVaTJXQVh4bmZYNkt5TW11NW5QMk9LTHhJbXk0VEFUOXBuazRJTEFZTy1sSnZWblhTcmRkR2Z5dXlaTnFySHdCWk9RWU1heTN2dktHWXAxaHFLd1JGejhCUTN3cGxYOFhObXBJY0d1cXRlUW81YkJrNlhMMlJvLUFQc1oyVzhMUDVCT1BRMkNhalhxMHJvREgzT09qTTNxVWFRVlY4WlhIMURYc3pOd2lXeU84dmVMMUNKemhxTWFPaEVZYVhWdTJqNmljVm9NMDdGMEJSSkcxRUZIMWFSN0JPRGY0Nl9LUmF0UDI4bUNBanY3QjBPUU55R2w3WHZKVi1fVlNpTEZ5RFhDZndSMGNtbGNYdUlzWmtoTjZfdVZHTllrQWVLczA3amFYSlktU0MweVlSbDdpdDV5c29pcWlDSF81SU41Z0NTU0hPWDFWUGxTcklRWmYwNWlIYlNZZ0gzU280Vjc1WGFQRHk5SzVSUmkydGQxd211YjVVZ3Bmc0hKdjdEV1B0OFRBN2xZdTlYOW9EbEVsVUsyY0lMNGxwdjZ5elhMemNXd0pPRjJLdFVDYm40MzNUem9NQ1hCNjc5XzZvSjRmVEVLb0lqMmZnb24xLWFQQkFGZG5OUVh3NmtBYUlycnowSlMydWYtVGx4T0pNUjhLQWFURExXbkh1WTlYQUhEZ3kxUzd1cEVmb25nN1VNOXhDMGc0eWFBem5xT0ZFX3BCV1NwVGRmUk44Y0hQa0NpcU5UdDROdVIwWW1CYmFTcUZuUXZrVHZXZVluX0JRbWlmYjUzeXlRb20xNTBiamkxS1dBSXpuZ1lmMnQwQzdyX2RCWFJpR0tZME5UTXRFc1Y2M29PRWlQRG9qcDVQWUhVNy13a3B0N3FQQXY1UVBwMTFBZkJnM243YVJUT2dEdzUzY2E4RXZRLTVaa3V5NUNOeWIzTUFhQ2FvM3BnS2NDU2hyM013Ym8zcWpsU2t3N3ZIWUtZUmkwQ3JNYUprcVNwaXZXY2VXd1VTX09FaEpaOWpTeEJqSWFNTFdTb0VaY1huNkE2RnpKaV9XbmZ4emVfalVvRXhMaTBjWnR2VWtQRFA2NloySWd6NFozU0VtM1pWWmtMZ1lnUkVRUnRFMkktS1FKZmU1T2RWOFZ3NFZaY2hFS2FSRzRZeVhacy0zWWowSDJXZlZsS3poUHM0Z0xPUEdNWEpQaDFrRWhSMGFkaTlVS0tkRGZlMGhWOUJIVjB5bmExWWFZWkk5UXoyOGtNUy1YaXZUb3FGZThhZTNGUkprMWlyMEhrWGdBcW5QVXJ5Y2ZXa0dCZXJJa2VLOGUyMVgtNzlrRmJzaEExTW1lZzNWWFhhSm8wXzNWaGoySHcxY3lnNlE3dkdTWGdfcEpYWjhBaE9QbkNaNWQ2WGt3SU1PbV9YaWRuWm15d1k3UmNUQ2dMdFJPbW1vcEZDTzV2X1lVRDlDMXhfSmxIb011UUMxbnBQdDRiQ0IwQTJwMzZIVlptV0VRWHozN1FvcXJjQ1ptY3BzQmlpZThOQ09qd2lTZ1hQZFZ2NVRLYk16SE1obEJQOExzSWtvdnhDS0pEbHJYaU5peDN2LW9hZHk3WHNHSWRTbDVkZEVXNmo5WDBDTDFfaVBWWFVfSC1aLUt6WVFxakNicWgzSVo4Z3JnSnhRa2NYMWxyaWl2Q0s5dnc1ek1aUk40R2YxWXZaZEVSTUsyUldDWUcwSEFZM243RWFlamFoNWVXVGtYZlVZLVgwMDdzZFV5bVpFQzhOTHJrdmRDaURYMU5BM05iQjNLMnpaNGpyWnFWWmFhaFp5c1JQbzIzR2tmaGQ4NFVUQm5KdHd0TVlGQ0FSM1dVX3lxVmk4UVZMN016bjk5Q1Zwelp4QlZySGgwTzNzVHVhRDFoTEFVdF90aE5LRnRzbnoyWDlzYlNRQ0t6Y0JPdTNWVEJ3bU1xWlJjNjdSVU5XS0ZlUm9EdDNCRU1EbDg3M2k4NGRfZmxRbDNNU0xfQWpjN0txQ1BudTNJX3Z4NFJzLUlVS09JVWFFSEFKTlA5LWo2QmV0SzQ5dlpQd2xNc2U3bHo1cHh6QjVnYVdpaDJRRnhteTlscklSRGRLa3ktd3N5LXJlTmdLSklKSmI2M1pvdEsxem54ZF9sUFdCMzE0emF4RU9NdV9lMmNUT1JrWDZMdU9IWjVVN0F6YzQtcUVFa0J0RURlSHc2alFUMHFIREN4ajVobFlYaFNtWEdPa1FwS3Q1cGZuR2ZTc2hzajI2anZacVlaMk8zWk5mWTl5S0lCcmYxU0lySkhSUUJwM3l5cFBxcUxhYXlhTnotWWFJNVM1RmVuV2dqYmVxSzRFUUhnS1RhT1JhUm1YdmVqcUd3UXRlNDdaVHdVbk1hVlc3U2RfNC0wLWFZcXNMUU5GbC1CbDZmMWk5cFVVZjRXbmlkVG9Nc25YemJxZVh4cnJpRURyVnBkbTlCX25oaEg2bHAydGFhR1FKOGFxWlhKWEdwQXdIaEE1ZmxNcUxJaWYxRGZ6Q3FSU2t6UFhzdXoxdXQyYWF2VEdfQXIwRGc4SzNvMEVxdkFFVnp0Q3o2c3JRN1ZaLWhVSjdWODI2b1RQWGd5RWh3SG8xMjZHcW41MExHRFJnd0VSZTg4Wnp3LXBNRjNTVFU3djFBTTh4MV9RNkVYREEwV21PcXVoOEJNNmNJTlU3RWxjeG5sdjYwSWppSHRheWZhSXZianM4QWpONHoyaGw0cFM5aFV6UmlQSjAtbWRsNmx6M1MxbHpGcU5SMjBRaktNNWJLU1AtVDBWa2VFSG51aklNM1hrWE56aWJBM1hkVUhndDk3WERKQndjQ2lRRWtzMExIR3RRYkhBVF9DNGxVTzhoR3Z6S09takJjM0tMUUNkRkdXa3AzeXp0eDNYV0Job2o1N1BsQk9OcVhUTnR1bnlQQVlIQUprcGM5UmNWNmx3YzVBRzYzWnBfSWdVRkllZl9TTGg3RUVuZTJUdG1iVHpJZjcyOTR6cHJhZ2lJTmJpbC1FWUkwdjR2WFIyZFJQR1BVRU5VSGNGb0JOV0R5cTg3bVdObWFZX3lSbkg1TjVWN3h6eS0xbWxCN29UdHY2dW5rREdkWnVjZ3lERlJkSjBjZnZHem5nX1I4NU9SLVd2VUx3d2ZHRTRwVl9sOW5YdEFCeEZzVVR6eEE4Q3lNUFRFeDNIOW96aVBzV3JjNC13eVBrYUl5cXFqSDd6NUhiNXBmTmNMRnBmT3lBbnBLX2pBZERaam5PYmxLYnFKVktReF9qelpXd1BUcWtoZWtEd25QTDVFdTZMa1hMdUJ2cjhKSGU2WTZTSUFrb0M=)
        SNAPCRAFT_BUILD_ENVIRONMENT: host
    scripts:
      - name: Authenticate
        script: |
          echo $SNAPCRAFT_LOGIN_CREDENTIALS | base64 --decode > /home/builder/snapcraft-login-credentials
          snapcraft login --with /home/builder/snapcraft-login-credentials
      - name: Create a snap
        script: snapcraft snap --output flutter-codemagic-example.snap
        when:
          changeset:
            excludes: 
              - '.'
      - name: Upload and release
        script: snapcraft upload flutter-codemagic-example.snap --release stable
        when:
          changeset:
            excludes: 
              - '.'
